============================= test session starts ==============================
platform linux -- Python 3.13.11, pytest-9.0.2, pluggy-1.6.0 -- /home/kamau/bsopt/.venv/bin/python3
cachedir: .pytest_cache
benchmark: 5.2.3 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/kamau/bsopt
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: cov-7.0.0, anyio-4.12.0, asyncio-1.3.0, mock-3.15.1, docker-3.2.5, Faker-40.1.2, timeout-2.4.0, benchmark-5.2.3, locust-2.43.1
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 180 items

tests/unit/pricing/calibration/test_calibration.py::TestHestonCalibrator::test_calibration_accuracy_synthetic PASSED [  0%]
tests/unit/pricing/calibration/test_calibration.py::TestHestonCalibrator::test_insufficient_data PASSED [  1%]
tests/unit/pricing/calibration/test_engine.py::test_market_option_properties PASSED [  1%]
tests/unit/pricing/calibration/test_engine.py::test_heston_calibrator_filter_liquid PASSED [  2%]
tests/unit/pricing/calibration/test_engine.py::test_heston_calibrator_weighted_objective PASSED [  2%]
tests/unit/pricing/calibration/test_engine.py::test_heston_calibrator_calibrate PASSED [  3%]
tests/unit/pricing/calibration/test_engine.py::test_heston_calibrator_calibrate_insufficient_options PASSED [  3%]
tests/unit/pricing/calibration/test_engine.py::test_heston_calibrator_calibrate_put PASSED [  4%]
tests/unit/pricing/calibration/test_engine.py::test_calibrate_surface PASSED [  5%]
tests/unit/pricing/calibration/test_engine.py::test_weighted_objective_all_fail PASSED [  5%]
tests/unit/pricing/calibration/test_engine.py::test_calibrate_surface_insufficient_options_per_maturity PASSED [  6%]
tests/unit/pricing/calibration/test_engine.py::test_calibrate_surface_insufficient_ivs PASSED [  6%]
tests/unit/pricing/calibration/test_svi.py::TestSVISurface::test_raw_svi_calculation PASSED [  7%]
tests/unit/pricing/calibration/test_svi.py::TestSVISurface::test_arbitrage_validation PASSED [  7%]
tests/unit/pricing/calibration/test_svi.py::TestSVISurface::test_svi_fitting PASSED [  8%]
tests/unit/pricing/calibration/test_svi_surface.py::test_raw_svi PASSED  [  8%]
tests/unit/pricing/calibration/test_svi_surface.py::test_validate_no_arbitrage PASSED [  9%]
tests/unit/pricing/calibration/test_svi_surface.py::test_fit_svi_slice PASSED [ 10%]
tests/unit/pricing/calibration/test_svi_surface.py::test_fit_svi_slice_arbitrage_penalty PASSED [ 10%]
tests/unit/pricing/calibration/test_svi_surface.py::test_get_implied_vol PASSED [ 11%]
tests/unit/pricing/graphql/test_schema.py::test_option_fields PASSED     [ 11%]
tests/unit/pricing/graphql/test_schema.py::test_option_fields_expired PASSED [ 12%]
tests/unit/pricing/graphql/test_schema.py::test_resolve_reference PASSED [ 12%]
tests/unit/pricing/graphql/test_schema.py::test_query_dummy PASSED       [ 13%]
tests/unit/pricing/models/test_heston_fft.py::test_heston_params_validation PASSED [ 13%]
tests/unit/pricing/models/test_heston_fft.py::test_heston_model_init PASSED [ 14%]
tests/unit/pricing/models/test_heston_fft.py::test_characteristic_func PASSED [ 15%]
tests/unit/pricing/models/test_heston_fft.py::test_characteristic_func_errors PASSED [ 15%]
tests/unit/pricing/models/test_heston_fft.py::test_price_call PASSED     [ 16%]
tests/unit/pricing/models/test_heston_fft.py::test_price_put PASSED      [ 16%]
tests/unit/pricing/models/test_heston_fft.py::test_pricing_integration_error_high PASSED [ 17%]
tests/unit/pricing/models/test_heston_fft.py::test_price_exceeds_spot PASSED [ 17%]
tests/unit/pricing/models/test_heston_fft.py::test_pricing_failed_exception PASSED [ 18%]
tests/unit/pricing/models/test_heston_fft.py::test_price_floor PASSED    [ 18%]
tests/unit/pricing/models/test_heston_fft.py::test_price_put_integrand_error PASSED [ 19%]
tests/unit/pricing/models/test_heston_fft.py::test_pricing_integration_errors PASSED [ 20%]
tests/unit/pricing/models/test_heston_fft.py::test_price_put_failure PASSED [ 20%]
tests/unit/pricing/models/test_heston_fft.py::test_integrand_zero_denominator PASSED [ 21%]
tests/unit/pricing/models/test_heston_fft.py::test_integrand_exception PASSED [ 21%]
tests/unit/pricing/models/test_heston_fft.py::test_price_put_integrand_exception PASSED [ 22%]
tests/unit/pricing/models/test_heston_fft.py::test_characteristic_func_overflow_guard PASSED [ 22%]
tests/unit/pricing/models/test_heston_fft.py::test_characteristic_func_singularity PASSED [ 23%]
tests/unit/pricing/models/test_models.py::test_bs_parameters_validation PASSED [ 23%]
tests/unit/pricing/models/test_models.py::test_bs_parameters_invalid_spot PASSED [ 24%]
tests/unit/pricing/models/test_models.py::test_bs_parameters_invalid_maturity PASSED [ 25%]
tests/unit/pricing/models/test_models.py::test_bs_parameters_invalid_rate PASSED [ 25%]
tests/unit/pricing/models/test_models.py::test_option_greeks_getitem PASSED [ 26%]
tests/unit/pricing/models/test_models.py::test_bs_parameters_array_validation PASSED [ 26%]
tests/unit/pricing/test_base.py::test_pricing_engine_with_strategy PASSED [ 27%]
tests/unit/pricing/test_base.py::test_pricing_engine_with_vectorized_strategy PASSED [ 27%]
tests/unit/pricing/test_base.py::test_pricing_engine_invalid_strategy PASSED [ 28%]
tests/unit/pricing/test_base.py::test_mock_strategy_greeks PASSED        [ 28%]
tests/unit/pricing/test_base.py::test_mock_vectorized_batch PASSED       [ 29%]
tests/unit/pricing/test_black_scholes.py::test_bs_engine_single_pricing PASSED [ 30%]
tests/unit/pricing/test_black_scholes.py::test_bs_engine_greeks PASSED   [ 30%]
tests/unit/pricing/test_black_scholes.py::test_bs_engine_batch_pricing PASSED [ 31%]
tests/unit/pricing/test_black_scholes.py::test_bs_engine_edge_cases PASSED [ 31%]
tests/unit/pricing/test_black_scholes.py::test_calculate_d1_d2 PASSED    [ 32%]
tests/unit/pricing/test_black_scholes.py::test_bs_engine_calculate_put PASSED [ 32%]
tests/unit/pricing/test_black_scholes.py::test_bs_engine_static_price_methods PASSED [ 33%]
tests/unit/pricing/test_black_scholes.py::test_bs_engine_greeks_put PASSED [ 33%]
tests/unit/pricing/test_black_scholes.py::test_bs_engine_greeks_zero_maturity PASSED [ 34%]
tests/unit/pricing/test_black_scholes.py::test_price_options_missing_params PASSED [ 35%]
tests/unit/pricing/test_black_scholes.py::test_calculate_greeks_batch_missing_params PASSED [ 35%]
tests/unit/pricing/test_black_scholes.py::test_calculate_greeks_batch_single PASSED [ 36%]
tests/unit/pricing/test_black_scholes.py::test_verify_put_call_parity PASSED [ 36%]
tests/unit/pricing/test_black_scholes.py::test_bs_engine_price_instance PASSED [ 37%]
tests/unit/pricing/test_black_scholes.py::test_bs_engine_calculate_greeks_instance PASSED [ 37%]
tests/unit/pricing/test_black_scholes.py::test_price_options_array_type PASSED [ 38%]
tests/unit/pricing/test_black_scholes.py::test_calculate_greeks_batch_with_params PASSED [ 38%]
tests/unit/pricing/test_black_scholes.py::test_calculate_greeks_batch_array_type PASSED [ 39%]
tests/unit/pricing/test_black_scholes.py::test_black_scholes_wrapper PASSED [ 40%]
tests/unit/pricing/test_exotic.py::test_exotic_parameters PASSED         [ 40%]
tests/unit/pricing/test_exotic.py::test_asian_geometric PASSED           [ 41%]
tests/unit/pricing/test_exotic.py::test_asian_arithmetic_mc PASSED       [ 41%]
tests/unit/pricing/test_exotic.py::test_barrier_analytical PASSED        [ 42%]
tests/unit/pricing/test_exotic.py::test_lookback_floating_analytical PASSED [ 42%]
tests/unit/pricing/test_exotic.py::test_lookback_mc PASSED               [ 43%]
tests/unit/pricing/test_exotic.py::test_digital_pricer PASSED            [ 43%]
tests/unit/pricing/test_exotic.py::test_lookback_extrema PASSED          [ 44%]
tests/unit/pricing/test_exotic.py::test_price_exotic_option_dispatch PASSED [ 45%]
tests/unit/pricing/test_exotic.py::test_barrier_in_type PASSED           [ 45%]
tests/unit/pricing/test_factory.py::test_factory_get_black_scholes PASSED [ 46%]
tests/unit/pricing/test_factory.py::test_factory_get_monte_carlo PASSED  [ 46%]
tests/unit/pricing/test_factory.py::test_factory_get_binomial PASSED     [ 47%]
tests/unit/pricing/test_factory.py::test_factory_get_fdm PASSED          [ 47%]
tests/unit/pricing/test_factory.py::test_factory_get_unknown PASSED      [ 48%]
tests/unit/pricing/test_factory.py::test_factory_case_insensitive PASSED [ 48%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_basic_pricing PASSED [ 49%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_zero_maturity PASSED [ 50%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_solve_method PASSED [ 50%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_greeks PASSED [ 51%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_greeks_zero_maturity PASSED [ 51%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_iterative PASSED [ 52%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_diagnostics_and_clone PASSED [ 52%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_greeks_edge_idx PASSED [ 53%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_iterative_failure PASSED [ 53%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_ilu_failure PASSED [ 54%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_greeks_zero_spot PASSED [ 55%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_solve_zero_maturity_call PASSED [ 55%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_solve_zero_maturity_put PASSED [ 56%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_get_greeks_small_maturity PASSED [ 56%]
tests/unit/pricing/test_finite_difference.py::test_fdm_solver_greeks_zero_maturity_put_otm PASSED [ 57%]
tests/unit/pricing/test_implied_vol.py::test_calculate_intrinsic_value PASSED [ 57%]
tests/unit/pricing/test_implied_vol.py::test_validate_inputs PASSED      [ 58%]
tests/unit/pricing/test_implied_vol.py::test_vectorized_implied_volatility_early_break PASSED [ 58%]
tests/unit/pricing/test_implied_vol.py::test_newton_raphson_iv_validation PASSED [ 59%]
tests/unit/pricing/test_implied_vol.py::test_implied_volatility_methods PASSED [ 60%]
tests/unit/pricing/test_implied_vol.py::test_implied_volatility_failure_fallback PASSED [ 60%]
tests/unit/pricing/test_implied_vol.py::test_brent_iv_failure PASSED     [ 61%]
tests/unit/pricing/test_implied_vol.py::test_vectorized_implied_volatility PASSED [ 61%]
tests/unit/pricing/test_implied_vol.py::test_vectorized_implied_volatility_non_convergence PASSED [ 62%]
tests/unit/pricing/test_implied_vol.py::test_vectorized_implied_volatility_empty PASSED [ 62%]
tests/unit/pricing/test_implied_vol.py::test_newton_raphson_iv_small_vega PASSED [ 63%]
tests/unit/pricing/test_init.py::test_pricing_init_dir PASSED            [ 63%]
tests/unit/pricing/test_init.py::test_pricing_init_getattr PASSED        [ 64%]
tests/unit/pricing/test_init.py::test_preload_classical_pricers PASSED   [ 65%]
tests/unit/pricing/test_init.py::test_auto_preload_logic PASSED          [ 65%]
tests/unit/pricing/test_lattice.py::test_binomial_pricer_european PASSED [ 66%]
tests/unit/pricing/test_lattice.py::test_binomial_pricer_american PASSED [ 66%]
tests/unit/pricing/test_lattice.py::test_binomial_pricer_greeks PASSED   [ 67%]
tests/unit/pricing/test_lattice.py::test_binomial_pricer_zero_maturity PASSED [ 67%]
tests/unit/pricing/test_lattice.py::test_binomial_pricer_build_tree PASSED [ 68%]
tests/unit/pricing/test_lattice.py::test_trinomial_pricer_european PASSED [ 68%]
tests/unit/pricing/test_lattice.py::test_trinomial_pricer_american PASSED [ 69%]
tests/unit/pricing/test_lattice.py::test_trinomial_pricer_greeks PASSED  [ 70%]
tests/unit/pricing/test_lattice.py::test_trinomial_pricer_zero_maturity PASSED [ 70%]
tests/unit/pricing/test_lattice.py::test_binomial_american_put PASSED    [ 71%]
tests/unit/pricing/test_lattice.py::test_trinomial_american_call_dividend PASSED [ 71%]
tests/unit/pricing/test_lattice.py::test_validate_convergence PASSED     [ 72%]
tests/unit/pricing/test_lattice.py::test_binomial_no_arbitrage_violation PASSED [ 72%]
tests/unit/pricing/test_main.py::test_health_check PASSED                [ 73%]
tests/unit/pricing/test_main.py::test_graphql_endpoint_exists PASSED     [ 73%]
tests/unit/pricing/test_monte_carlo.py::test_mc_config_validation PASSED [ 74%]
tests/unit/pricing/test_monte_carlo.py::test_mc_engine_basic_pricing PASSED [ 75%]
tests/unit/pricing/test_monte_carlo.py::test_mc_engine_price_european_variants PASSED [ 75%]
tests/unit/pricing/test_monte_carlo.py::test_mc_engine_invalid_option_type PASSED [ 76%]
tests/unit/pricing/test_monte_carlo.py::test_mc_engine_sobol PASSED      [ 76%]
tests/unit/pricing/test_monte_carlo.py::test_mc_engine_generate_normals_standard PASSED [ 77%]
tests/unit/pricing/test_monte_carlo.py::test_mc_engine_american_lsm PASSED [ 77%]
tests/unit/pricing/test_monte_carlo.py::test_mc_engine_american_lsm_no_itm PASSED [ 78%]
tests/unit/pricing/test_monte_carlo.py::test_geometric_asian_price PASSED [ 78%]
tests/unit/pricing/test_quant_utils.py::test_fast_normal_cdf PASSED      [ 79%]
tests/unit/pricing/test_quant_utils.py::test_fast_normal_pdf PASSED      [ 80%]
tests/unit/pricing/test_quant_utils.py::test_corrado_miller_initial_guess PASSED [ 80%]
tests/unit/pricing/test_quant_utils.py::test_calculate_d1_d2_jit PASSED  [ 81%]
tests/unit/pricing/test_quant_utils.py::test_batch_bs_price_jit PASSED   [ 81%]
tests/unit/pricing/test_quant_utils.py::test_batch_bs_price_jit_stability PASSED [ 82%]
tests/unit/pricing/test_quant_utils.py::test_batch_greeks_jit PASSED     [ 82%]
tests/unit/pricing/test_quantum_backend.py::test_get_local_backend PASSED [ 83%]
tests/unit/pricing/test_quantum_backend.py::test_get_remote_backend_no_provider PASSED [ 83%]
tests/unit/pricing/test_quantum_backend.py::test_get_remote_backend_no_token PASSED [ 84%]
tests/unit/pricing/test_quantum_backend.py::test_get_remote_backend_success PASSED [ 85%]
tests/unit/pricing/test_quantum_backend.py::test_get_remote_backend_provider_init_failure PASSED [ 85%]
tests/unit/pricing/test_quantum_backend.py::test_get_remote_backend_retrieval_failure PASSED [ 86%]
tests/unit/pricing/test_quantum_pricing.py::test_quantum_option_pricer_init PASSED [ 86%]
tests/unit/pricing/test_quantum_pricing.py::test_add_payoff_operator_coverage PASSED [ 87%]
tests/unit/pricing/test_quantum_pricing.py::test_price_european_call_quantum_errors PASSED [ 87%]
tests/unit/pricing/test_quantum_pricing.py::test_create_stock_price_distribution PASSED [ 88%]
tests/unit/pricing/test_quantum_pricing.py::test_add_payoff_operator PASSED [ 88%]
tests/unit/pricing/test_quantum_pricing.py::test_price_european_call_quantum PASSED [ 89%]
tests/unit/pricing/test_quantum_pricing.py::test_quantum_circuit_optimizer PASSED [ 90%]
tests/unit/pricing/test_quantum_pricing.py::test_hybrid_pricer_adaptive PASSED [ 90%]
tests/unit/pricing/test_quantum_pricing.py::test_quantum_pricer_backend_env PASSED [ 91%]
tests/unit/pricing/test_vectorized_black_scholes.py::test_deprecated_vectorized_pricing PASSED [ 91%]
tests/unit/pricing/test_vectorized_black_scholes.py::test_deprecated_vectorized_greeks PASSED [ 92%]
tests/unit/pricing/test_vectorized_wrapper.py::test_deprecated_wrapper_price PASSED [ 92%]
tests/unit/pricing/test_vectorized_wrapper.py::test_deprecated_wrapper_greeks PASSED [ 93%]
tests/unit/pricing/test_vol_surface.py::test_svi_parameters_validation PASSED [ 93%]
tests/unit/pricing/test_vol_surface.py::test_svi_natural_parameters PASSED [ 94%]
tests/unit/pricing/test_vol_surface.py::test_sabr_parameters_validation PASSED [ 95%]
tests/unit/pricing/test_vol_surface.py::test_svi_model PASSED            [ 95%]
tests/unit/pricing/test_vol_surface.py::test_sabr_model PASSED           [ 96%]
tests/unit/pricing/test_vol_surface.py::test_calibration_engine_svi PASSED [ 96%]
tests/unit/pricing/test_vol_surface.py::test_calibration_engine_errors PASSED [ 97%]
tests/unit/pricing/test_vol_surface.py::test_calibrate_sabr PASSED       [ 97%]
tests/unit/pricing/test_vol_surface.py::test_arbitrage_detector PASSED   [ 98%]
tests/unit/pricing/test_vol_surface.py::test_volatility_surface PASSED   [ 98%]
tests/unit/pricing/test_vol_surface.py::test_volatility_surface_empty PASSED [ 99%]
tests/unit/pricing/test_vol_surface.py::test_volatility_surface_dataframe_and_smile PASSED [100%]
ERROR: Coverage failure: total of 41 is less than fail-under=90


================================ tests coverage ================================
_______________ coverage: platform linux, python 3.13.11-final-0 _______________

Name                                            Stmts   Miss  Cover   Missing
-----------------------------------------------------------------------------
src/__init__.py                                     1      0   100%
src/aiops/__init__.py                               0      0   100%
src/aiops/aiops_orchestrator.py                   113    113     0%   1-205
src/aiops/autoencoder_detector.py                  63     63     0%   1-93
src/aiops/data_drift_detector.py                   68     68     0%   1-105
src/aiops/docker_remediator.py                     26     26     0%   1-30
src/aiops/isolation_forest_detector.py             21     21     0%   1-29
src/aiops/ml_pipeline_trigger.py                   19     19     0%   1-22
src/aiops/prometheus_adapter.py                    38     38     0%   1-58
src/aiops/redis_remediator.py                      30     30     0%   1-39
src/aiops/self_healing_orchestrator.py             34     34     0%   1-59
src/aiops/timeseries_anomaly_detector.py           33     33     0%   1-65
src/api/__init__.py                                 0      0   100%
src/api/exceptions/__init__.py                      1      0   100%
src/api/exceptions/exceptions.py                   41      5    88%   11-22
src/api/graphql/schema.py                          38      8    79%   24-25, 42-43, 55-56, 71-72
src/api/main.py                                   111     40    64%   26-46, 51, 92-94, 119-138, 142, 147, 152, 157-158, 170, 181
src/api/middleware/__init__.py                      4      0   100%
src/api/middleware/idempotency.py                  76     76     0%   1-138
src/api/middleware/logging.py                     177    140    21%   88-93, 97-103, 107-113, 117-119, 124-135, 139-151, 155, 159, 162-283, 288-322, 334-335, 339, 343-350, 353-354, 357-358, 361-362, 365-366, 369-370, 373-376
src/api/middleware/profiling.py                    24     24     0%   5-46
src/api/middleware/request_id.py                   21     11    48%   37-39, 43-57, 62
src/api/middleware/security.py                    221    174    21%   64-72, 76, 89, 104-110, 114-121, 125, 128-169, 214-220, 224, 228-229, 233-245, 249-260, 264-285, 289-342, 362-367, 372-383, 388-400, 404-419, 425, 428-437, 469-472, 476-477, 481-484, 489-495, 498-517
src/api/providers/__init__.py                       1      1     0%   1
src/api/providers/market_data.py                   15     15     0%   1-21
src/api/routes/__init__.py                          7      0   100%
src/api/routes/auth.py                            213    169    21%   146-209, 237-244, 277-336, 361-378, 401-442, 468-492, 511-537, 558-583, 606-626, 650-673, 691-745
src/api/routes/debug.py                            17      8    53%   22-40
src/api/routes/ml.py                               37     24    35%   34-70
src/api/routes/pricing.py                         134    103    23%   58, 89-185, 213-250, 275-295, 323-339, 364-409
src/api/routes/system.py                            6      1    83%   9
src/api/routes/users.py                            99     58    41%   56-57, 76-77, 94-110, 128-135, 152, 183-205, 217, 231-240, 250-253, 268-275
src/api/routes/websocket.py                        22     14    36%   23-47
src/api/schemas/__init__.py                         5      0   100%
src/api/schemas/auth.py                           133     45    66%   76-96, 102-104, 110-112, 187-204, 210-212, 236-238, 244-246, 279-282
src/api/schemas/common.py                          47      0   100%
src/api/schemas/ml.py                              19      0   100%
src/api/schemas/pricing.py                        105      3    97%   34-36
src/api/schemas/user.py                            43      0   100%
src/api/websockets/codec.py                        33     18    45%   16-27, 31-38
src/api/websockets/manager.py                      77     44    43%   29, 47-61, 65-76, 83-114
src/audit/__init__.py                               0      0   100%
src/audit/middleware.py                            29     20    31%   10-12, 15-55
src/auth/__init__.py                                0      0   100%
src/auth/security.py                               48     28    42%   24-30, 33-67, 76-83
src/blockchain/__init__.py                          9      9     0%   5-25
src/blockchain/defi_options.py                     38     38     0%   1-95
src/cli/__init__.py                                 0      0   100%
src/cli/auth.py                                    75     75     0%   9-117
src/cli/config.py                                  53     53     0%   8-89
src/cli/portfolio.py                               75     75     0%   8-148
src/config.py                                     151     43    72%   148, 152, 161, 169, 177, 185, 193, 202-203, 208, 213, 218, 223, 248-268, 278-291, 302-311
src/data/__init__.py                                0      0   100%
src/data/pipeline.py                               33     33     0%   1-58
src/data/router.py                                 57     57     0%   1-84
src/data/validation.py                             16     16     0%   1-23
src/database/__init__.py                          110     73    34%   37-71, 89, 95-96, 105, 122-129, 143-154, 172-175, 180-183, 198-202, 220-229, 237-240, 253-260, 267-274
src/database/crud.py                              167    167     0%   11-668
src/database/models.py                            282     31    89%   81, 115, 158-160, 163, 189, 230, 234-235, 238, 289, 293, 296-299, 302, 374, 420, 454-457, 460, 483, 523, 567, 610, 638, 677
src/database/verify.py                             40     40     0%   1-61
src/ml/__init__.py                                 17     17     0%   1-89
src/ml/autonomous_pipeline.py                      85     85     0%   1-190
src/ml/celery_app.py                               21     21     0%   1-50
src/ml/data_loader.py                              26     26     0%   1-55
src/ml/drift.py                                    55     55     0%   1-127
src/ml/forecasting/__init__.py                      0      0   100%
src/ml/forecasting/tft_model.py                    53     53     0%   1-135
src/ml/main.py                                     12     12     0%   1-16
src/ml/registry/__init__.py                         0      0   100%
src/ml/registry/promote.py                         21     21     0%   5-43
src/ml/reinforcement_learning/__init__.py           0      0   100%
src/ml/reinforcement_learning/online_agent.py     131    131     0%   1-241
src/ml/reinforcement_learning/trading_env.py       88     88     0%   1-185
src/ml/reinforcement_learning/train.py             78     78     0%   1-168
src/ml/rl/__init__.py                               0      0   100%
src/ml/rl/augmented_agent.py                       64     64     0%   1-131
src/ml/scraper.py                                 118    118     0%   1-155
src/ml/trainer.py                                 160    160     0%   1-241
src/pricing/__init__.py                            15      0   100%
src/pricing/base.py                                27      0   100%
src/pricing/black_scholes.py                      126      0   100%
src/pricing/calibration/__init__.py                 0      0   100%
src/pricing/calibration/engine.py                 102      0   100%
src/pricing/calibration/svi_surface.py             38      0   100%
src/pricing/exotic.py                             178      0   100%
src/pricing/factory.py                             16      0   100%
src/pricing/finite_difference.py                  147      0   100%
src/pricing/graphql/schema.py                      59      0   100%
src/pricing/implied_vol.py                         91      0   100%
src/pricing/lattice.py                            154      2    99%   145, 395
src/pricing/main.py                                12      0   100%
src/pricing/models/__init__.py                     34      0   100%
src/pricing/models/heston_fft.py                  108      0   100%
src/pricing/monte_carlo.py                        135      0   100%
src/pricing/quant_utils.py                         87      0   100%
src/pricing/quantum_backend.py                     37      1    97%   8
src/pricing/quantum_pricing.py                    125      0   100%
src/pricing/vectorized_black_scholes.py            18      0   100%
src/pricing/vol_surface.py                        201      0   100%
src/protos/__init__.py                              1      1     0%   5
src/protos/market_data_pb2.py                      42     42     0%   7-62
src/protos/market_data_pb2_grpc.py                 12     12     0%   3-18
src/scrapers/__init__.py                            0      0   100%
src/scrapers/engine.py                             48     48     0%   1-83
src/security/__init__.py                            3      0   100%
src/security/audit.py                              54     23    57%   77-121
src/security/auth.py                              202    129    36%   74, 78-84, 88-90, 94-96, 110-112, 124, 128, 132, 146-162, 170-182, 191-194, 202-227, 237-252, 256-261, 271-306, 311, 319, 331-370, 377-382, 390-397, 404-409, 416, 425-450, 474-519
src/security/breach_notification.py                36     36     0%   8-108
src/security/mfa.py                                21     21     0%   8-42
src/security/password.py                          123     78    37%   80-144, 180, 193-198, 212, 227, 243-249, 272-299, 309, 319
src/security/rate_limit.py                         39     32    18%   12-70
src/services/email_service.py                      52     32    38%   36-37, 48-70, 83-106
src/shared/__init__.py                              0      0   100%
src/shared/db.py                                   29     29     0%   1-60
src/shared/observability.py                        68     31    54%   39, 72-80, 87-118
src/shared/security.py                             52     36    31%   14, 20-43, 51, 59-71, 77-79, 90-96, 103-105
src/streaming/__init__.py                          11     11     0%   1-36
src/streaming/analytics.py                         29     29     0%   1-75
src/streaming/consumer.py                          62     62     0%   1-122
src/streaming/health.py                            36     36     0%   4-49
src/streaming/kafka_consumer.py                    51     51     0%   1-110
src/streaming/kafka_producer.py                    27     27     0%   1-93
src/streaming/main.py                              26     26     0%   1-46
src/streaming/mesh_producer.py                     33     33     0%   1-77
src/streaming/producer.py                          30     30     0%   1-94
src/tasks/__init__.py                               2      0   100%
src/tasks/audit_tasks.py                           21     21     0%   1-46
src/tasks/celery_app.py                            94     25    73%   273, 279, 285, 291, 297, 311-313, 327-333, 342-353, 375, 408, 426, 442
src/tasks/data_tasks.py                           105    105     0%   12-377
src/tasks/email_tasks.py                           35     23    34%   35-71, 79-85
src/tasks/graceful_shutdown.py                     34     34     0%   1-54
src/tasks/ml_tasks.py                              30     30     0%   7-78
src/tasks/pricing_tasks.py                        136    136     0%   13-424
src/tasks/trading_tasks.py                         40     40     0%   7-106
src/utils/__init__.py                               0      0   100%
src/utils/cache.py                                196    144    27%   22-25, 64-86, 91-95, 99, 103-112, 119-130, 135-144, 148-160, 166-175, 185-206, 214-239, 250-257, 266-274, 277-287, 299-306, 311-315
src/utils/circuit_breaker.py                      132     72    45%   40-60, 65-69, 74-76, 88-89, 106-109, 112-113, 116, 119-120, 123, 126, 129-130, 133, 136-174
src/utils/dashboard.py                             15     15     0%   1-115
src/utils/errors.py                                23     23     0%   5-46
src/utils/lazy_import.py                           84     15    82%   50-51, 81-82, 91, 128-141, 147, 186-187
src/utils/sanitization.py                          22     17    23%   8-17, 23-25, 32-42
src/utils/schemas_pb2.py                           17     17     0%   7-33
src/workers/__init__.py                             0      0   100%
src/workers/math_worker.py                         94     94     0%   1-183
src/workers/webhook_worker.py                      40     40     0%   1-69
-----------------------------------------------------------------------------
TOTAL                                            8202   4822    41%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
FAIL Required test coverage of 90% not reached. Total coverage: 41.21%
============================= slowest 10 durations =============================
17.05s call     tests/unit/pricing/calibration/test_engine.py::test_heston_calibrator_calibrate
2.06s call     tests/unit/pricing/test_quantum_pricing.py::test_hybrid_pricer_adaptive
1.54s call     tests/unit/pricing/test_quantum_pricing.py::test_price_european_call_quantum_errors
1.44s setup    tests/unit/pricing/calibration/test_calibration.py::TestHestonCalibrator::test_calibration_accuracy_synthetic
0.99s call     tests/unit/pricing/test_quantum_pricing.py::test_price_european_call_quantum
0.51s call     tests/unit/pricing/test_finite_difference.py::test_fdm_solver_get_greeks_small_maturity
0.41s call     tests/unit/pricing/test_finite_difference.py::test_fdm_solver_greeks_zero_spot
0.41s call     tests/unit/pricing/test_finite_difference.py::test_fdm_solver_greeks_edge_idx
0.12s call     tests/unit/pricing/test_exotic.py::test_price_exotic_option_dispatch
0.11s call     tests/unit/pricing/calibration/test_calibration.py::TestHestonCalibrator::test_calibration_accuracy_synthetic
============================= 180 passed in 39.00s =============================
