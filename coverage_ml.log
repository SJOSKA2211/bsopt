============================= test session starts ==============================
platform linux -- Python 3.13.11, pytest-9.0.2, pluggy-1.6.0 -- /home/kamau/bsopt/.venv/bin/python3
cachedir: .pytest_cache
benchmark: 5.2.3 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/kamau/bsopt
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, asyncio-1.3.0, mock-3.15.1, docker-3.2.5, Faker-40.1.2, timeout-2.4.0, benchmark-5.2.3, locust-2.43.1, xdist-3.8.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 147 items

tests/ml/test_anomaly_detection.py::test_isolation_forest_detector_init PASSED [  0%]
tests/ml/test_anomaly_detection.py::test_isolation_forest_detector_fit_predict_univariate PASSED [  1%]
tests/ml/test_anomaly_detection.py::test_isolation_forest_detector_no_outliers PASSED [  2%]
tests/ml/test_anomaly_detection.py::test_isolation_forest_detector_empty_data PASSED [  2%]
tests/ml/test_anomaly_detection.py::test_isolation_forest_detector_fit_predict_series_data PASSED [  3%]
tests/ml/test_anomaly_detection.py::test_isolation_forest_detector_not_fitted_predict_raises_error PASSED [  4%]
tests/ml/test_anomaly_detection.py::test_isolation_forest_detector_invalid_contamination PASSED [  4%]
tests/ml/test_anomaly_detection.py::test_isolation_forest_detector_fit_predict_1d_data PASSED [  5%]
tests/ml/test_anomaly_detection.py::test_isolation_forest_detector_predict_1d_data PASSED [  6%]
tests/ml/test_augmented_agent.py::test_augmented_agent_initialization PASSED [  6%]
tests/ml/test_augmented_agent.py::test_observation_concatenation PASSED  [  7%]
tests/ml/test_augmented_agent.py::test_agent_act_no_model PASSED         [  8%]
tests/ml/test_augmented_agent.py::test_agent_act_with_augmented_state PASSED [  8%]
tests/ml/test_autoencoder_anomaly_detection.py::test_autoencoder_detector_init PASSED [  9%]
tests/ml/test_autoencoder_anomaly_detection.py::test_autoencoder_detector_fit_predict_multivariate PASSED [ 10%]
tests/ml/test_autoencoder_anomaly_detection.py::test_autoencoder_detector_empty_data PASSED [ 10%]
tests/ml/test_autoencoder_anomaly_detection.py::test_autoencoder_detector_not_fitted_predict_raises_error PASSED [ 11%]
tests/ml/test_autoencoder_anomaly_detection.py::test_autoencoder_detector_predict_multivariate PASSED [ 12%]
tests/ml/test_autonomous_pipeline.py::test_pipeline_run PASSED           [ 12%]
tests/ml/test_autonomous_pipeline.py::test_pipeline_scrape_retry PASSED  [ 13%]
tests/ml/test_autonomous_pipeline.py::test_pipeline_failure PASSED       [ 14%]
tests/ml/test_autonomous_pipeline.py::test_objective_function PASSED     [ 14%]
tests/ml/test_autonomous_pipeline.py::test_pytorch_framework PASSED      [ 15%]
tests/ml/test_celery.py::test_run_pipeline_task_success PASSED           [ 16%]
tests/ml/test_celery.py::test_run_pipeline_task_failure PASSED           [ 17%]
tests/ml/test_data_drift_detector.py::test_data_drift_detector_init PASSED [ 17%]
tests/ml/test_data_drift_detector.py::test_data_drift_detector_no_drift PASSED [ 18%]
tests/ml/test_data_drift_detector.py::test_data_drift_detector_psi_drift_detected PASSED [ 19%]
tests/ml/test_data_drift_detector.py::test_data_drift_detector_ks_drift_detected PASSED [ 19%]
tests/ml/test_data_drift_detector.py::test_data_drift_detector_empty_data_raises_error PASSED [ 20%]
tests/ml/test_data_drift_detector.py::test_data_drift_detector_unequal_dimensions_raises_error PASSED [ 21%]
tests/ml/test_data_drift_detector.py::test_data_drift_detector_multivariate_detection PASSED [ 21%]
tests/ml/test_db.py::test_market_data_model PASSED                       [ 22%]
tests/ml/test_db.py::test_db_connection PASSED                           [ 23%]
tests/ml/test_db.py::test_minio_storage PASSED                           [ 23%]
tests/ml/test_db_schema_tft.py::test_market_data_symbol_tagging PASSED   [ 24%]
tests/ml/test_db_schema_tft.py::test_timescaledb_hypertable_status_mocked PASSED [ 25%]
tests/ml/test_distributed_trainer.py::test_train_distributed_success PASSED [ 25%]
tests/ml/test_distributed_trainer.py::test_distributed_trainer_selects_best PASSED [ 26%]
tests/ml/test_drift.py::test_ks_test_instrumentation PASSED              [ 27%]
tests/ml/test_drift.py::test_calculate_ks_test_no_drift PASSED           [ 27%]
tests/ml/test_drift.py::test_calculate_ks_test_significant_drift PASSED  [ 28%]
tests/ml/test_drift.py::test_drift_instrumentation PASSED                [ 29%]
tests/ml/test_drift.py::test_calculate_psi_no_drift PASSED               [ 29%]
tests/ml/test_drift.py::test_calculate_psi_significant_drift PASSED      [ 30%]
tests/ml/test_drift.py::test_calculate_psi_zero_bin_handling PASSED      [ 31%]
tests/ml/test_drift.py::test_performance_drift_monitor PASSED            [ 31%]
tests/ml/test_drift.py::test_performance_drift_alert_instrumentation PASSED [ 32%]
tests/ml/test_drift.py::test_performance_drift_insufficient_history PASSED [ 33%]
tests/ml/test_environment.py::test_src_directories_exist PASSED          [ 34%]
tests/ml/test_environment.py::test_tests_directory_exists PASSED         [ 34%]
tests/ml/test_environment.py::test_dependencies_installed[numpy] PASSED  [ 35%]
tests/ml/test_environment.py::test_dependencies_installed[pandas] PASSED [ 36%]
tests/ml/test_environment.py::test_dependencies_installed[xgboost] PASSED [ 36%]
tests/ml/test_environment.py::test_dependencies_installed[optuna] PASSED [ 37%]
tests/ml/test_environment.py::test_dependencies_installed[mlflow] PASSED [ 38%]
tests/ml/test_environment.py::test_dependencies_installed[prometheus_client] PASSED [ 38%]
tests/ml/test_environment.py::test_dependencies_installed[structlog] PASSED [ 39%]
tests/ml/test_environment.py::test_dependencies_installed[sklearn] PASSED [ 40%]
tests/ml/test_federated_learning.py::test_coordinator_initialization PASSED [ 40%]
tests/ml/test_federated_learning.py::test_coordinator_start_server PASSED [ 41%]
tests/ml/test_instrumentation.py::test_trainer_new_prometheus_metrics PASSED [ 42%]
tests/ml/test_instrumentation.py::test_trainer_error_metrics PASSED      [ 42%]
tests/ml/test_instrumentation.py::test_structlog_configuration PASSED    [ 43%]
tests/ml/test_instrumentation.py::test_pipeline_scrape_execution PASSED  [ 44%]
tests/ml/test_integration.py::test_pipeline_run PASSED                   [ 44%]
tests/ml/test_ml_lazy_loading.py::test_ml_does_not_load_heavy_deps_on_import SKIPPED [ 45%]
tests/ml/test_ml_lazy_loading.py::test_ml_loads_dep_on_attribute_access PASSED [ 46%]
tests/ml/test_mlops_training_workflow.py::test_mlops_training_workflow_exists PASSED [ 46%]
tests/ml/test_mlops_training_workflow.py::test_mlops_training_workflow_contents PASSED [ 47%]
tests/ml/test_model_promotion.py::test_compare_models_script_exists PASSED [ 48%]
tests/ml/test_model_promotion.py::test_promote_script_exists PASSED      [ 48%]
tests/ml/test_model_promotion.py::test_model_promotion_logic PASSED      [ 49%]
tests/ml/test_observability.py::test_setup_logging_json PASSED           [ 50%]
tests/ml/test_observability.py::test_metrics_definitions PASSED          [ 51%]
tests/ml/test_observability_configs.py::test_prometheus_rules_valid_yaml PASSED [ 51%]
tests/ml/test_observability_configs.py::test_grafana_dashboard_valid_json PASSED [ 52%]
tests/ml/test_online_agent.py::test_init PASSED                          [ 53%]
tests/ml/test_online_agent.py::test_get_state_vector PASSED              [ 53%]
tests/ml/test_online_agent.py::test_process_market_data PASSED           [ 54%]
tests/ml/test_online_agent.py::test_process_market_data_no_model PASSED  [ 55%]
tests/ml/test_online_agent.py::test_run_loop PASSED                      [ 55%]
tests/ml/test_online_agent.py::test_produce_signal_failed PASSED         [ 56%]
tests/ml/test_online_agent.py::test_flush_experience PASSED              [ 57%]
tests/ml/test_online_agent.py::test_init_without_kafka_libs PASSED       [ 57%]
tests/ml/test_ray_scaling.py::test_ray_import PASSED                     [ 58%]
tests/ml/test_ray_scaling.py::test_sb3_import PASSED                     [ 59%]
tests/ml/test_ray_scaling.py::test_gymnasium_import PASSED               [ 59%]
tests/ml/test_ray_scaling.py::test_ray_distributed_execution PASSED      [ 60%]
tests/ml/test_retraining_dag.py::test_neural_greeks_flow_execution PASSED [ 61%]
tests/ml/test_retraining_dag.py::test_dag_structure PASSED               [ 61%]
tests/ml/test_scraper.py::test_fetch_historical_data_success PASSED      [ 62%]
tests/ml/test_scraper.py::test_fetch_historical_data_retry_logic PASSED  [ 63%]
tests/ml/test_scraper.py::test_fetch_historical_data_failure PASSED      [ 63%]
tests/ml/test_scraper.py::test_fetch_historical_data_polygon_success PASSED [ 64%]
tests/ml/test_scraper.py::test_fetch_historical_data_auto_provider PASSED [ 65%]
tests/ml/test_scraper.py::test_scraper_redact_api_key PASSED             [ 65%]
tests/ml/test_scraper.py::test_scraper_invalid_ticker PASSED             [ 66%]
tests/ml/test_sentiment_extractor.py::test_sentiment_extractor_initialization PASSED [ 67%]
tests/ml/test_sentiment_extractor.py::test_extract_sentiment_score PASSED [ 68%]
tests/ml/test_sentiment_extractor.py::test_sentiment_extractor_load_failure PASSED [ 68%]
tests/ml/test_sentiment_extractor.py::test_extract_sentiment_batch PASSED [ 69%]
tests/ml/test_sentiment_integration.py::test_sentiment_pipeline_processing PASSED [ 70%]
tests/ml/test_sentiment_integration.py::test_sentiment_pipeline_empty_text PASSED [ 70%]
tests/ml/test_sentiment_integration.py::test_sentiment_pipeline_error_handling PASSED [ 71%]
tests/ml/test_sentiment_integration.py::test_sentiment_pipeline_initialization PASSED [ 72%]
tests/ml/test_tft_model.py::test_tft_model_initialization PASSED         [ 72%]
tests/ml/test_tft_model.py::test_prepare_data_logic PASSED               [ 73%]
tests/ml/test_tft_model.py::test_tft_model_train PASSED                  [ 74%]
tests/ml/test_tft_model.py::test_tft_model_predict PASSED                [ 74%]
tests/ml/test_tft_model.py::test_get_interpretability_report_trained PASSED [ 75%]
tests/ml/test_tft_model.py::test_tft_model_invalid_data PASSED           [ 76%]
tests/ml/test_tft_model.py::test_tft_model_predict_not_trained PASSED    [ 76%]
tests/ml/test_tft_model.py::test_get_interpretability_report_not_trained PASSED [ 77%]
tests/ml/test_tft_model.py::test_prepare_data_with_volume PASSED         [ 78%]
tests/ml/test_trading_env.py::test_trading_env_initialization PASSED     [ 78%]
tests/ml/test_trading_env.py::test_trading_env_reset PASSED              [ 79%]
tests/ml/test_trading_env.py::test_trading_env_step PASSED               [ 80%]
tests/ml/test_trading_env.py::test_trading_env_drawdown_truncation PASSED [ 80%]
tests/ml/test_trading_env_advanced.py::test_reward_function_risk_awareness PASSED [ 81%]
tests/ml/test_trading_env_advanced.py::test_transaction_cost_deduction PASSED [ 82%]
tests/ml/test_trading_env_advanced.py::test_action_clipping PASSED       [ 82%]
tests/ml/test_train.py::test_train_td3_initialization PASSED             [ 83%]
tests/ml/test_train.py::test_train_distributed_function PASSED           [ 84%]
tests/ml/test_train.py::test_train_td3_logs_params PASSED                [ 85%]
tests/ml/test_train.py::test_train_td3_logs_model PASSED                 [ 85%]
tests/ml/test_train.py::test_main_function PASSED                        [ 86%]
tests/ml/test_train.py::test_mlflow_callback PASSED                      [ 87%]
tests/ml/test_train.py::test_train_distributed_ray_not_available PASSED  [ 87%]
tests/ml/test_train.py::test_main_function_distributed PASSED            [ 88%]
tests/ml/test_trainer.py::test_trainer_initialization PASSED             [ 89%]
tests/ml/test_trainer.py::test_trainer_train_xgboost PASSED              [ 89%]
tests/ml/test_trainer.py::test_trainer_logging PASSED                    [ 90%]
tests/ml/test_trainer.py::test_trainer_prometheus_metrics_usage PASSED   [ 91%]
tests/ml/test_trainer.py::test_trainer_mlflow_uri PASSED                 [ 91%]
tests/ml/test_trainer.py::test_mlflow_logging_content PASSED             [ 92%]
tests/ml/test_trainer.py::test_trainer_frameworks PASSED                 [ 93%]
tests/ml/test_trainer.py::test_trainer_optuna_integration PASSED         [ 93%]
tests/ml/test_trainer.py::test_base_trainer_abstract_methods PASSED      [ 94%]
tests/ml/test_trainer.py::test_trainer_mlflow_artifacts PASSED           [ 95%]
tests/ml/test_trainer.py::test_trainer_dataset_lineage PASSED            [ 95%]
tests/ml/test_v2_1_instrumentation.py::test_training_duration_is_histogram PASSED [ 96%]
tests/ml/test_v2_1_instrumentation.py::test_push_metrics_integration PASSED [ 97%]
tests/ml/test_v2_1_instrumentation.py::test_metric_names_match_prd PASSED [ 97%]
tests/ml/test_v2_1_instrumentation.py::test_trainer_updates_rmse PASSED  [ 98%]
tests/ml/test_v2_1_instrumentation.py::test_pipeline_updates_drift_score PASSED [ 99%]
tests/ml/test_v2_1_instrumentation.py::test_structlog_json_formatting PASSED [100%]/usr/lib/python3.13/ast.py:50: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x7ff355c2aa70>
  return compile(source, filename, mode, flags,

ERROR: Coverage failure: total of 55 is less than fail-under=90


================================ tests coverage ================================
_______________ coverage: platform linux, python 3.13.11-final-0 _______________

Name                                            Stmts   Miss  Cover   Missing
-----------------------------------------------------------------------------
src/__init__.py                                     1      0   100%
src/aiops/__init__.py                               0      0   100%
src/aiops/aiops_orchestrator.py                   113      3    97%   179-205
src/aiops/autoencoder_detector.py                  63      0   100%
src/aiops/data_drift_detector.py                   68      0   100%
src/aiops/docker_remediator.py                     26      0   100%
src/aiops/isolation_forest_detector.py             21      0   100%
src/aiops/ml_pipeline_trigger.py                   19      0   100%
src/aiops/prometheus_adapter.py                    38      0   100%
src/aiops/redis_remediator.py                      30      0   100%
src/aiops/self_healing_orchestrator.py             34      0   100%
src/aiops/timeseries_anomaly_detector.py           33      0   100%
src/api/__init__.py                                 0      0   100%
src/api/exceptions/__init__.py                      1      0   100%
src/api/exceptions/exceptions.py                   41      0   100%
src/api/graphql/schema.py                          38      4    89%   24-25, 55-56
src/api/main.py                                   111      0   100%
src/api/middleware/__init__.py                      4      0   100%
src/api/middleware/idempotency.py                  76      0   100%
src/api/middleware/logging.py                     177     29    84%   129, 133, 208-209, 212-213, 262, 264-265, 271, 288-322
src/api/middleware/profiling.py                    24      0   100%
src/api/middleware/request_id.py                   21     11    48%   37-39, 43-57, 62
src/api/middleware/security.py                    221     39    82%   109, 119-120, 165, 167, 236, 244-245, 258, 274-285, 295-299, 313-314, 320-321, 375, 393-398, 404-419, 425, 494, 508
src/api/providers/__init__.py                       1      0   100%
src/api/providers/market_data.py                   15      0   100%
src/api/routes/__init__.py                          7      0   100%
src/api/routes/auth.py                            213      9    96%   298, 517, 570, 730-734, 739, 749
src/api/routes/debug.py                            17      0   100%
src/api/routes/ml.py                               37      0   100%
src/api/routes/pricing.py                         134      0   100%
src/api/routes/system.py                            6      0   100%
src/api/routes/users.py                            99      0   100%
src/api/routes/websocket.py                        22      0   100%
src/api/schemas/__init__.py                         5      0   100%
src/api/schemas/auth.py                           133     17    87%   79, 82, 85, 88, 91, 94, 103, 111, 190, 193, 196, 199, 202, 211, 237, 245, 281
src/api/schemas/common.py                          47      0   100%
src/api/schemas/ml.py                              19      0   100%
src/api/schemas/pricing.py                        105      1    99%   35
src/api/schemas/user.py                            43      0   100%
src/api/services/option_service.py                 36      7    81%   50-68
src/api/services/portfolio_service.py              26     10    62%   7-12, 23-24, 28-29
src/api/websockets/codec.py                        33      0   100%
src/api/websockets/manager.py                      77      0   100%
src/audit/__init__.py                               0      0   100%
src/audit/middleware.py                            29      6    79%   28, 46-53
src/auth/__init__.py                                0      0   100%
src/auth/security.py                               48     22    54%   24-30, 33-67
src/blockchain/__init__.py                          9      9     0%   5-25
src/blockchain/defi_options.py                     38     38     0%   1-95
src/cli/__init__.py                                 0      0   100%
src/cli/auth.py                                    75     75     0%   9-117
src/cli/config.py                                  53     53     0%   8-89
src/cli/portfolio.py                               75     75     0%   8-148
src/config.py                                     151     41    73%   148, 152, 161, 169, 177, 185, 193, 202-203, 208, 218, 248-268, 278-291, 302-311
src/data/__init__.py                                0      0   100%
src/data/pipeline.py                               33     33     0%   1-58
src/data/router.py                                 57     40    30%   25-56, 60-69, 73-84
src/data/validation.py                             16     16     0%   1-23
src/database/__init__.py                          110     56    49%   89, 95-96, 124, 143-154, 172-175, 180-183, 198-202, 220-229, 237-240, 253-260, 267-274
src/database/crud.py                              167    167     0%   11-668
src/database/models.py                            282     31    89%   81, 115, 158-160, 163, 189, 230, 234-235, 238, 289, 293, 296-299, 302, 374, 420, 454-457, 460, 483, 523, 567, 610, 638, 677
src/database/verify.py                             40     40     0%   1-61
src/ml/__init__.py                                 17      3    82%   65, 82, 89
src/ml/architectures/neural_network.py             26     18    31%   16-27, 30, 34-35, 46-51
src/ml/autonomous_pipeline.py                      85     15    82%   121, 162-190
src/ml/celery_app.py                               21      0   100%
src/ml/data_loader.py                              26     18    31%   18-36, 43-55
src/ml/drift.py                                    55      0   100%
src/ml/federated_learning/coordinator.py           21      4    81%   25-26, 47-48
src/ml/forecasting/__init__.py                      0      0   100%
src/ml/forecasting/tft_model.py                    53      1    98%   81
src/ml/main.py                                     12     12     0%   1-16
src/ml/pipelines/dag_neural_greeks.py              13      2    85%   18, 22
src/ml/pipelines/orchestrator.py                  119     76    36%   53-54, 58, 75-194, 200, 209-215, 223-226, 230
src/ml/pipelines/retraining.py                     18     10    44%   14-15, 21-33
src/ml/pipelines/sentiment_ingest.py               69     41    41%   16-31, 37-64, 70-94, 140-145
src/ml/registry/__init__.py                         0      0   100%
src/ml/registry/promote.py                         21      6    71%   37-43
src/ml/reinforcement_learning/__init__.py           0      0   100%
src/ml/reinforcement_learning/online_agent.py     131     23    82%   8-9, 13-15, 45-46, 75-76, 122, 147-149, 159, 174, 179, 189-190, 197, 200, 218-219, 227
src/ml/reinforcement_learning/trading_env.py       88      2    98%   92, 142
src/ml/reinforcement_learning/train.py             78      6    92%   15-16, 98-99, 120, 168
src/ml/rl/__init__.py                               0      0   100%
src/ml/rl/augmented_agent.py                       64      7    89%   49-51, 73, 112, 114-115
src/ml/scraper.py                                 118     44    63%   23, 28, 74-91, 96, 105-112, 134-152
src/ml/trainer.py                                 160      0   100%
src/ml/training/train.py                           88     64    27%   25-59, 64-84, 91-98, 105-114, 121-126, 136-169, 173
src/pricing/__init__.py                            15      3    80%   47, 50, 64
src/pricing/base.py                                27     10    63%   23, 28, 46, 51, 61, 65-71
src/pricing/black_scholes.py                      126     59    53%   18, 30, 41-45, 53-54, 66-67, 71-72, 76-105, 116, 134-139, 142, 155, 164, 183-188, 191, 204, 211, 229-237, 241-243
src/pricing/calibration/__init__.py                 0      0   100%
src/pricing/calibration/engine.py                 102     69    32%   25, 29, 33, 46-47, 51-57, 61-94, 98-139, 143-179
src/pricing/calibration/svi_surface.py             38     24    37%   17, 22-31, 36-49, 53-55
src/pricing/exotic.py                             178    111    38%   48-73, 82-137, 162, 164, 187-189, 196-198, 202-219, 225-258, 264-275, 279-290, 299-318, 326-331, 336, 338, 344-363
src/pricing/factory.py                             16      1    94%   46
src/pricing/finite_difference.py                  147    128    13%   33-36, 40-56, 60-70, 74-76, 82-113, 117-190, 196-203, 210-304, 309-316, 320
src/pricing/implied_vol.py                         91     49    46%   31, 47, 49, 51, 53, 55, 59, 64, 81, 83, 85, 116, 121, 135-153, 171, 175, 193-199, 216-275
src/pricing/lattice.py                            154    124    19%   37-82, 90-134, 141-157, 168-169, 173, 189-285, 289-296, 305-306, 310, 326-422
src/pricing/main.py                                12     12     0%   1-16
src/pricing/models/__init__.py                     34      4    88%   27, 29, 31, 46
src/pricing/models/heston_fft.py                  108     44    59%   22, 25, 28, 52, 54, 68-69, 87-88, 91-93, 100, 104, 115, 117-119, 127, 134, 138-139, 142-145, 149-172
src/pricing/monte_carlo.py                        135    111    18%   18-30, 39-40, 44-45, 52, 59-104, 111-117, 123-178, 184-194, 201-222
src/pricing/quant_utils.py                         87     71    18%   20, 28, 44-67, 75-78, 92-120, 134-187
src/pricing/quantum_backend.py                     37     37     0%   1-58
src/pricing/quantum_pricing.py                    125    125     0%   1-262
src/pricing/vectorized_black_scholes.py            18     18     0%   6-81
src/pricing/vol_surface.py                        201    201     0%   8-376
src/protos/__init__.py                              1      0   100%
src/protos/market_data_pb2.py                      42     29    31%   34-62
src/protos/market_data_pb2_grpc.py                 12     12     0%   3-18
src/scrapers/__init__.py                            0      0   100%
src/scrapers/engine.py                             48     31    35%   27-30, 33-65, 69-72, 76-83
src/security/__init__.py                            3      0   100%
src/security/audit.py                              54      2    96%   119-121
src/security/auth.py                              202     59    71%   74, 78-84, 89, 94-96, 160, 220, 238, 246, 258-259, 288-294, 346-350, 355, 366-367, 378, 390-397, 416, 425-450, 474-519
src/security/breach_notification.py                36     36     0%   8-108
src/security/mfa.py                                21     21     0%   8-42
src/security/password.py                          123     46    63%   86-87, 94-95, 101-102, 108-109, 114-118, 126-127, 133-139, 212, 243-249, 272-299, 309
src/security/rate_limit.py                         39     13    67%   15-18, 29-32, 51-58
src/services/email_service.py                      52     32    38%   36-37, 48-70, 83-106
src/shared/__init__.py                              0      0   100%
src/shared/db.py                                   29      1    97%   60
src/shared/observability.py                        68     24    65%   77-78, 87-118
src/shared/security.py                             52     36    31%   14, 20-43, 51, 59-71, 77-79, 90-96, 103-105
src/streaming/__init__.py                          11     11     0%   1-36
src/streaming/analytics.py                         29     29     0%   1-75
src/streaming/consumer.py                          62     62     0%   1-122
src/streaming/health.py                            36     36     0%   4-49
src/streaming/kafka_consumer.py                    51     51     0%   1-110
src/streaming/kafka_producer.py                    27     27     0%   1-93
src/streaming/main.py                              26     26     0%   1-46
src/streaming/mesh_producer.py                     33     33     0%   1-77
src/streaming/producer.py                          30     30     0%   1-94
src/tasks/__init__.py                               2      0   100%
src/tasks/audit_tasks.py                           21     13    38%   24-46
src/tasks/celery_app.py                            94     25    73%   273, 279, 285, 291, 297, 311-313, 327-333, 342-353, 375, 408, 426, 442
src/tasks/data_tasks.py                           105    105     0%   12-377
src/tasks/email_tasks.py                           35     23    34%   35-71, 79-85
src/tasks/graceful_shutdown.py                     34     34     0%   1-54
src/tasks/ml_tasks.py                              30     30     0%   7-78
src/tasks/pricing_tasks.py                        136    136     0%   13-424
src/tasks/trading_tasks.py                         40     40     0%   7-106
src/utils/__init__.py                               0      0   100%
src/utils/cache.py                                196    111    43%   22-25, 64-86, 91-95, 104-108, 126, 128-130, 142-144, 148-160, 169-175, 185-206, 214-239, 250-257, 268, 272-274, 279, 285-287, 299-306, 311-315
src/utils/circuit_breaker.py                      132     78    41%   40-60, 65-69, 74-76, 78-80, 85-89, 106-109, 112-113, 116, 119-120, 123, 126, 129-130, 133, 136-174
src/utils/dashboard.py                             15     15     0%   1-115
src/utils/errors.py                                23     23     0%   5-46
src/utils/lazy_import.py                           84     16    81%   50-51, 72-73, 81-82, 91, 128-141, 186-187
src/utils/sanitization.py                          22      8    64%   9, 23-25, 33, 38, 41-42
src/utils/schemas_pb2.py                           17     17     0%   7-33
src/workers/__init__.py                             0      0   100%
src/workers/math_worker.py                         94     94     0%   1-183
src/workers/webhook_worker.py                      40     40     0%   1-69
-----------------------------------------------------------------------------
TOTAL                                            8559   3840    55%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
FAIL Required test coverage of 90% not reached. Total coverage: 55.13%
============================= slowest 10 durations =============================
32.50s call     tests/ml/test_distributed_trainer.py::test_train_distributed_success
26.62s call     tests/ml/test_trainer.py::test_trainer_optuna_integration
20.05s call     tests/ml/test_distributed_trainer.py::test_distributed_trainer_selects_best
17.37s call     tests/ml/test_trainer.py::test_trainer_frameworks
14.03s call     tests/ml/test_trainer.py::test_trainer_train_xgboost
12.00s call     tests/ml/test_sentiment_integration.py::test_sentiment_pipeline_empty_text
7.02s call     tests/ml/test_v2_1_instrumentation.py::test_trainer_updates_rmse
5.28s call     tests/ml/test_trainer.py::test_trainer_dataset_lineage
5.27s call     tests/ml/test_trainer.py::test_mlflow_logging_content
5.24s call     tests/ml/test_trainer.py::test_trainer_prometheus_metrics_usage
=========================== short test summary info ============================
SKIPPED [1] tests/ml/test_ml_lazy_loading.py:12: torch already loaded
================== 146 passed, 1 skipped in 194.45s (0:03:14) ==================
