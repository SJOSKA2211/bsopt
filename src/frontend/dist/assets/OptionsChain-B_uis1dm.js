import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{Jn as t,kr as n}from"./vendor-Bna3BMbj.js";import{B as r,E as i,G as a,I as o,J as s,K as c,L as l,M as u,R as d,T as f,W as p,X as m,Y as h,Z as g,a as _,g as v,h as y,m as b,rt as x,s as S,t as C,tt as w,w as T,z as E}from"./vendor-mui-8knhrtHX.js";import{t as D}from"./vendor-query-BOInhiz5.js";var O=e(n(),1),k=t();const A=O.memo(({option:e,type:t,action:n})=>{let[a,s]=(0,O.useState)(!1),[c,u]=(0,O.useState)(!1),[f,m]=(0,O.useState)({open:!1,message:``,severity:`success`}),_=O.useCallback(()=>{s(!0)},[]),v=O.useCallback(()=>{s(!1)},[]),y=O.useCallback(()=>{m(e=>({...e,open:!1}))},[]),b=O.useCallback(()=>{u(!0),fetch(`/api/v1/trades/execute`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({optionId:e.id,type:t,action:n,amount:1})}).then(e=>{if(!e.ok)throw Error(`Trade failed`);return e.json()}).then(e=>{m({open:!0,message:e.message||`Trade executed successfully`,severity:`success`}),s(!1)}).catch(e=>{m({open:!0,message:e.message||`Trade execution failed`,severity:`error`})}).finally(()=>{u(!1)})},[e.id,t,n]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(p,{variant:n===`buy`?`contained`:`outlined`,color:n===`buy`?`primary`:`secondary`,size:`small`,onClick:_,children:n.toUpperCase()}),(0,k.jsxs)(r,{open:a,onClose:v,children:[(0,k.jsx)(o,{children:`Confirm Trade`}),(0,k.jsx)(d,{children:(0,k.jsxs)(l,{children:[`Are you sure you want to `,n,` `,t,` option for strike `,e.strike,`?`]})}),(0,k.jsxs)(E,{children:[(0,k.jsx)(p,{onClick:v,disabled:c,children:`Cancel`}),(0,k.jsx)(p,{onClick:b,autoFocus:!0,disabled:c,children:c?(0,k.jsx)(g,{size:24,"aria-label":`Executing trade`}):`Confirm`})]})]}),(0,k.jsx)(i,{open:f.open,autoHideDuration:6e3,onClose:y,children:(0,k.jsx)(h,{onClose:y,severity:f.severity,sx:{width:`100%`},children:f.message})})]})}),j=O.memo(({symbol:e,onOptionSelect:t})=>{let n=w(),[r,i]=(0,O.useState)(``),[o,l]=(0,O.useState)(`all`),{data:d,isLoading:p}=D({queryKey:[`options-chain`,e,o],queryFn:async()=>(await fetch(`/api/v1/options/chain?symbol=${e}&expiry=${o}`)).json(),refetchInterval:3e3}),h=(0,O.useMemo)(()=>{if(!d)return[];let e=d;if(r){let t=r.toLowerCase();e=e.filter(e=>e.strike.toString().includes(t))}return e},[d,r]),g=O.useCallback(e=>{i(e.target.value)},[]),E=O.useCallback((e,t)=>{t&&l(t)},[]),j=O.useCallback(e=>{t?.(e.row)},[t]),M=(0,O.useMemo)(()=>[{field:`call_bid`,headerName:`Bid`,width:80,headerClassName:`call-header`,renderCell:e=>(0,k.jsxs)(s,{variant:`price`,color:`financial.bid`,sx:{fontWeight:`bold`},children:[`$`,e.value?.toFixed(2)]})},{field:`call_ask`,headerName:`Ask`,width:80,headerClassName:`call-header`,renderCell:e=>(0,k.jsxs)(s,{variant:`price`,color:`financial.ask`,sx:{fontWeight:`bold`},children:[`$`,e.value?.toFixed(2)]})},{field:`call_last`,headerName:`Last`,width:90,headerClassName:`call-header`,renderCell:e=>{let t=e.row,n=(t.call_last-t.call_bid)/t.call_bid*100;return(0,k.jsxs)(T,{spacing:.5,children:[(0,k.jsxs)(s,{variant:`price`,sx:{fontWeight:`bold`},children:[`$`,e.value?.toFixed(2)]}),(0,k.jsx)(c,{label:`${n>=0?`+`:``}${n.toFixed(1)}%`,size:`small`,color:n>=0?`success`:`error`,sx:{height:20,fontSize:`0.7rem`}})]})}},{field:`call_volume`,headerName:`Vol`,width:80,headerClassName:`call-header`,valueFormatter:e=>e?.toLocaleString()},{field:`call_oi`,headerName:`OI`,width:80,headerClassName:`call-header`,valueFormatter:e=>e?.toLocaleString()},{field:`call_iv`,headerName:`IV`,width:70,headerClassName:`call-header`,renderCell:e=>(0,k.jsx)(f,{title:`Implied Volatility`,children:(0,k.jsxs)(s,{variant:`percentage`,children:[(e.value*100).toFixed(1),`%`]})})},{field:`call_greeks`,headerName:`Greeks`,width:100,headerClassName:`call-header`,renderCell:()=>(0,k.jsx)(m,{size:`small`,children:(0,k.jsx)(_,{fontSize:`small`})})},{field:`call_action`,headerName:`Action`,width:100,headerClassName:`call-header`,renderCell:e=>(0,k.jsx)(A,{option:e.row,type:`call`,action:`buy`})},{field:`strike`,headerName:`Strike`,width:120,headerClassName:`strike-header`,renderCell:e=>{let t=e.row,r=Math.abs(t.strike-t.underlying_price)<1,i=t.strike<t.underlying_price,o=t.strike>t.underlying_price;return(0,k.jsxs)(a,{sx:{width:`100%`,height:`100%`,display:`flex`,alignItems:`center`,justifyContent:`center`,backgroundColor:r?x(n.palette.primary.main,.2):`transparent`,borderLeft:i?`3px solid ${n.palette.financial.positive}`:`none`,borderRight:o?`3px solid ${n.palette.financial.positive}`:`none`},children:[(0,k.jsxs)(s,{variant:`h6`,fontWeight:`bold`,color:r?`primary.main`:`text.primary`,children:[`$`,e.value]}),r&&(0,k.jsx)(c,{label:`ATM`,size:`small`,color:`primary`,sx:{ml:1,height:20}})]})}},{field:`put_action`,headerName:`Action`,width:100,headerClassName:`put-header`,renderCell:e=>(0,k.jsx)(A,{option:e.row,type:`put`,action:`buy`})},{field:`put_greeks`,headerName:`Greeks`,width:100,headerClassName:`put-header`,renderCell:()=>(0,k.jsx)(m,{size:`small`,children:(0,k.jsx)(_,{fontSize:`small`})})},{field:`put_iv`,headerName:`IV`,width:70,headerClassName:`put-header`,renderCell:e=>(0,k.jsx)(f,{title:`Implied Volatility`,children:(0,k.jsxs)(s,{variant:`percentage`,children:[(e.value*100).toFixed(1),`%`]})})},{field:`put_oi`,headerName:`OI`,width:80,headerClassName:`put-header`,valueFormatter:e=>e?.toLocaleString()},{field:`put_volume`,headerName:`Vol`,width:80,headerClassName:`put-header`,valueFormatter:e=>e?.toLocaleString()},{field:`put_last`,headerName:`Last`,width:90,headerClassName:`put-header`,renderCell:e=>{let t=e.row,n=(t.put_last-t.put_bid)/t.put_bid*100;return(0,k.jsxs)(T,{spacing:.5,children:[(0,k.jsxs)(s,{variant:`price`,sx:{fontWeight:`bold`},children:[`$`,e.value?.toFixed(2)]}),(0,k.jsx)(c,{label:`${n>=0?`+`:``}${n.toFixed(1)}%`,size:`small`,color:n>=0?`success`:`error`,sx:{height:20,fontSize:`0.7rem`}})]})}},{field:`put_ask`,headerName:`Ask`,width:80,headerClassName:`put-header`,renderCell:e=>(0,k.jsxs)(s,{variant:`price`,color:`financial.ask`,sx:{fontWeight:`bold`},children:[`$`,e.value?.toFixed(2)]})},{field:`put_bid`,headerName:`Bid`,width:80,headerClassName:`put-header`,renderCell:e=>(0,k.jsxs)(s,{variant:`price`,color:`financial.bid`,sx:{fontWeight:`bold`},children:[`$`,e.value?.toFixed(2)]})}],[n]);return(0,k.jsxs)(a,{sx:{height:`100%`,display:`flex`,flexDirection:`column`},children:[(0,k.jsxs)(T,{direction:`row`,spacing:2,alignItems:`center`,sx:{p:2,borderBottom:`1px solid ${x(n.palette.divider,.1)}`},children:[(0,k.jsxs)(s,{variant:`h6`,sx:{flexGrow:1},children:[`Options Chain - `,e]}),(0,k.jsx)(v,{size:`small`,placeholder:`Search strike...`,value:r,onChange:g,InputProps:{startAdornment:(0,k.jsx)(u,{position:`start`,children:(0,k.jsx)(S,{})})},sx:{width:200}}),(0,k.jsxs)(b,{value:o,exclusive:!0,onChange:E,size:`small`,children:[(0,k.jsx)(y,{value:`all`,children:`All`}),(0,k.jsx)(y,{value:`week`,children:`1W`}),(0,k.jsx)(y,{value:`month`,children:`1M`}),(0,k.jsx)(y,{value:`quarter`,children:`3M`})]})]}),(0,k.jsx)(a,{sx:{flex:1},children:(0,k.jsx)(C,{rows:h,columns:M,loading:p,disableRowSelectionOnClick:!0,onRowClick:j,sx:{border:`none`,"& .call-header":{backgroundColor:x(n.palette.financial.positive,.1),borderBottom:`2px solid ${n.palette.financial.positive}`},"& .put-header":{backgroundColor:x(n.palette.financial.negative,.1),borderBottom:`2px solid ${n.palette.financial.negative}`},"& .strike-header":{backgroundColor:x(n.palette.primary.main,.15),borderBottom:`2px solid ${n.palette.primary.main}`},"& .MuiDataGrid-cell":{borderRight:`1px solid ${x(n.palette.divider,.5)}`},"& .MuiDataGrid-row:hover":{backgroundColor:x(n.palette.primary.main,.05),cursor:`pointer`}},initialState:{pagination:{paginationModel:{pageSize:20}}},pageSizeOptions:[20,50,100]})})]})});export{j as OptionsChain};