import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{Jn as t,kr as n}from"./vendor-Bna3BMbj.js";import{G as r,rt as i,tt as a}from"./vendor-mui-8knhrtHX.js";import{d as o,l as s,u as c}from"./vendor-charts-G-6mPCR0.js";var l=n();function u(e){let[t,n]=(0,l.useState)(null),[r,i]=(0,l.useState)(!1),a=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(!e.enabled)return;let t=()=>{let r=new WebSocket(e.url);a.current=r,r.onopen=()=>{i(!0),console.log(`WebSocket connected`),r.send(JSON.stringify({type:`subscribe`,symbols:e.symbols}))},r.onmessage=e=>{n(JSON.parse(e.data))},r.onclose=()=>{i(!1),console.log(`WebSocket disconnected. Attempting to reconnect...`),setTimeout(t,3e3)},r.onerror=e=>{console.error(`WebSocket error:`,e),r.close()}};return t(),()=>{a.current?.close()}},[e.url,e.symbols,e.enabled]),{data:t,isConnected:r}}var d=t();const f=({symbol:e})=>{let t=a(),n=(0,l.useRef)(null),f=(0,l.useRef)(null),p=(0,l.useRef)(null),{data:m}=u({url:`ws://localhost:1234/marketdata`,symbols:[e],enabled:!0});return(0,l.useEffect)(()=>{if(!n.current)return;let e=o(n.current,{width:n.current.clientWidth,height:n.current.clientHeight,layout:{background:{type:c.Solid,color:t.palette.background.paper},textColor:t.palette.text.secondary},grid:{vertLines:{color:i(t.palette.divider,.1)},horzLines:{color:i(t.palette.divider,.1)}},crosshair:{mode:s.Normal},rightPriceScale:{borderColor:i(t.palette.divider,.2)},timeScale:{borderColor:i(t.palette.divider,.2),timeVisible:!0,secondsVisible:!1}}),r=e.addCandlestickSeries({upColor:t.palette.success.main,downColor:t.palette.error.main,borderVisible:!1,wickUpColor:t.palette.success.main,wickDownColor:t.palette.error.main}),a=[],l=new Date;for(let e=0;e<100;e++){let t=new Date(l.getTime()-(100-e)*6e4);a.push({time:Math.floor(t.getTime()/1e3),open:150+Math.random()*10,high:165+Math.random()*10,low:145+Math.random()*10,close:155+Math.random()*10})}r.setData(a),f.current=e,p.current=r;let u=()=>{n.current&&f.current&&f.current.resize(n.current.clientWidth,n.current.clientHeight)};return window.addEventListener(`resize`,u),()=>{window.removeEventListener(`resize`,u),e.remove()}},[t]),(0,l.useEffect)(()=>{m&&m.symbol===e&&p.current&&p.current.update({time:m.time,open:m.open,high:m.high,low:m.low,close:m.close})},[m,e]),(0,d.jsx)(r,{"data-testid":`live-price-chart-container`,ref:n,sx:{width:`100%`,height:`100%`,minHeight:400}})};export{f as LivePriceChart};