import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{Jn as t,kr as n}from"./vendor-Bna3BMbj.js";import{G as r,J as i,Z as a,rt as o,tt as s}from"./vendor-mui-8knhrtHX.js";import{t as c}from"./vendor-query-BOInhiz5.js";import{a as l,c as u,i as d,n as f,o as p,r as m,s as h,t as g}from"./vendor-charts-G-6mPCR0.js";var _=e(n(),1),v=e(u(),1),y=t();h([l,m,d,f,g]);const b=_.memo(({symbol:e,greek:t})=>{let n=s(),{data:l,isLoading:u,error:d}=c({queryKey:[`options-chain`,e,`all`],queryFn:async()=>{let t=await fetch(`/api/v1/options/chain?symbol=${e}&expiry=all`);if(!t.ok)throw Error(`Failed to fetch options data`);return t.json()}}),f=(0,_.useMemo)(()=>{if(!l||l.length===0)return null;let e=Array.from(new Set(l.map(e=>e.strike))).sort((e,t)=>e-t),r=Array.from(new Set(l.map(e=>e.expiry))).sort(),i=l.map(n=>{let i=e.indexOf(n.strike),a=r.indexOf(n.expiry),o=0;return t===`delta`?o=n.call_delta:t===`gamma`?o=n.call_gamma:t===`iv`&&(o=n.call_iv),[i,a,o]});return{tooltip:{position:`top`,formatter:n=>`Strike: $${e[n.data[0]]}<br/>Expiry: ${r[n.data[1]]}<br/>${t.toUpperCase()}: ${n.data[2].toFixed(4)}`},grid:{height:`80%`,top:`10%`,left:`10%`,right:`5%`},xAxis:{type:`category`,data:e.map(e=>`$${e}`),splitArea:{show:!0},axisLabel:{color:n.palette.text.secondary}},yAxis:{type:`category`,data:r,splitArea:{show:!0},axisLabel:{color:n.palette.text.secondary}},visualMap:{min:0,max:1,calculable:!0,orient:`horizontal`,left:`center`,bottom:`0%`,inRange:{color:[o(n.palette.primary.main,.1),n.palette.primary.main,n.palette.secondary.main]},textStyle:{color:n.palette.text.secondary}},series:[{name:`${t.toUpperCase()} Heatmap`,type:`heatmap`,data:i,label:{show:!1},emphasis:{itemStyle:{shadowBlur:10,shadowColor:`rgba(0, 0, 0, 0.5)`}}}],backgroundColor:`transparent`}},[l,t,n]);return u?(0,y.jsx)(r,{sx:{display:`flex`,justifyContent:`center`,alignItems:`center`,height:`100%`,minHeight:300},children:(0,y.jsx)(a,{"aria-label":`Loading Greeks heatmap`})}):d||!l?(0,y.jsx)(r,{sx:{p:4,textAlign:`center`},children:(0,y.jsx)(i,{color:`error`,children:`Error loading heatmap data`})}):(0,y.jsx)(r,{"data-testid":`greeks-heatmap-container`,sx:{width:`100%`,height:`100%`,minHeight:400},children:f&&(0,y.jsx)(v.default,{echarts:p,option:f,style:{height:`100%`,width:`100%`},theme:n.palette.mode===`dark`?`dark`:void 0})})});export{b as GreeksHeatmap};